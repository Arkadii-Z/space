<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Солнечная система с улучшенной графикой</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
            color: white;
        }
        
        #container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        #ui {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            z-index: 100;
        }
        
        .control-panel {
            background: rgba(0, 30, 60, 0.7);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(0, 100, 255, 0.5);
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 80%;
            max-width: 600px;
        }
        
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .slider-container label {
            display: flex;
            justify-content: space-between;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: rgba(100, 150, 255, 0.3);
            border-radius: 3px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4db8ff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 200, 255, 0.8);
        }
        
        .planet-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .planet-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(50, 50, 100, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .planet-btn:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(100, 200, 255, 0.8);
        }
        
        .planet-btn.active {
            transform: scale(1.3);
            box-shadow: 0 0 20px rgba(0, 200, 255, 1);
            border-color: white;
        }
        
        #title {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 28px;
            text-shadow: 0 0 10px rgba(0, 200, 255, 0.8);
            letter-spacing: 2px;
        }
        
        #instructions {
            position: absolute;
            top: 70px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 16px;
            color: #a0d0ff;
            text-shadow: 0 0 5px rgba(0, 100, 255, 0.5);
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #4db8ff;
        }
        
        .planet-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 14px;
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            border: 1px solid rgba(100, 200, 255, 0.5);
            white-space: nowrap;
            z-index: 10;
        }
        
        .info-card {
            position: absolute;
            background: rgba(0, 30, 60, 0.95);
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(0, 100, 255, 0.5);
            border: 1px solid rgba(100, 200, 255, 0.3);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 200;
        }
        
        .info-card h3 {
            margin-bottom: 10px;
            color: #4db8ff;
            border-bottom: 1px solid rgba(100, 200, 255, 0.3);
            padding-bottom: 5px;
        }
        
        .info-card p {
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .info-card a {
            color: #4db8ff;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
            pointer-events: auto;
        }
        
        .info-card a:hover {
            text-decoration: underline;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 30, 50, 0.95);
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            height: 70%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(0, 150, 255, 0.5);
            border: 1px solid rgba(100, 200, 255, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(100, 200, 255, 0.3);
        }
        
        .modal-header h2 {
            color: #4db8ff;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #4db8ff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            color: #ff4d4d;
            transform: scale(1.2);
        }
        
        .modal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .search-container {
            display: flex;
            margin-bottom: 15px;
        }
        
        #planet-search {
            flex: 1;
            padding: 10px;
            border-radius: 5px 0 0 5px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            background: rgba(0, 20, 40, 0.8);
            color: white;
            outline: none;
        }
        
        #search-btn {
            padding: 10px 15px;
            background: #4db8ff;
            border: none;
            border-radius: 0 5px 5px 0;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #search-btn:hover {
            background: #3399ff;
        }
        
        #google-frame {
            flex: 1;
            border: none;
            border-radius: 5px;
            background: white;
        }
        
        .camera-hint {
            position: absolute;
            bottom: 120px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 14px;
            color: #a0d0ff;
            text-shadow: 0 0 5px rgba(0, 100, 255, 0.5);
            opacity: 0.8;
        }
        
        .info-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: #4db8ff;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
        }
        
        .info-icon:hover {
            color: #ffcc00;
            transform: scale(1.2);
        }
        
        .controls-hint {
            position: absolute;
            bottom: 150px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 14px;
            color: #a0d0ff;
            text-shadow: 0 0 5px rgba(0, 100, 255, 0.5);
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="title">ИНТЕРАКТИВНАЯ СОЛНЕЧНАЯ СИСТЕМА</div>
    <div id="instructions">Наведите курсор на планету для информации, нажмите для поиска в Google</div>
    <div class="controls-hint">Зажмите колесо мыши для свободного перемещения камеры</div>
    <div class="camera-hint">Используйте WASD для перемещения, QE для подъема/опускания</div>
    
    <div id="ui">
        <div class="control-panel">
            <div class="slider-container">
                <label>
                    <span>Скорость вращения:</span>
                    <span id="speed-value">1.0x</span>
                </label>
                <input type="range" id="rotation-speed" min="0" max="2" step="0.1" value="1">
            </div>
            
            <div class="slider-container">
                <label>
                    <span>Размер планет:</span>
                    <span id="size-value">1.0x</span>
                </label>
                <input type="range" id="planet-size" min="0.5" max="3" step="0.1" value="1">
            </div>
            
            <div class="planet-selector">
                <div class="planet-btn active" data-planet="sun"><i class="fas fa-sun"></i></div>
                <div class="planet-btn" data-planet="mercury"><i class="fas fa-circle"></i></div>
                <div class="planet-btn" data-planet="venus"><i class="fas fa-circle"></i></div>
                <div class="planet-btn" data-planet="earth"><i class="fas fa-globe-americas"></i></div>
                <div class="planet-btn" data-planet="mars"><i class="fas fa-circle"></i></div>
                <div class="planet-btn" data-planet="jupiter"><i class="fas fa-circle"></i></div>
                <div class="planet-btn" data-planet="saturn"><i class="fas fa-ring"></i></div>
                <div class="planet-btn" data-planet="uranus"><i class="fas fa-circle"></i></div>
                <div class="planet-btn" data-planet="neptune"><i class="fas fa-circle"></i></div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="google-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Поиск изображений</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-container">
                    <input type="text" id="planet-search" placeholder="Введите название планеты...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <iframe id="google-frame" src="about:blank"></iframe>
            </div>
        </div>
    </div>
    
    <div class="loading" id="loading">Загрузка солнечной системы...</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script>
        // Основные переменные
        let scene, camera, renderer, controls;
        let planets = {};
        let rotationSpeed = 1;
        let planetSize = 1;
        let currentFocus = 'sun';
        let planetLabels = {};
        let infoCard = null;
        let raycaster, mouse;
        let freeCamEnabled = false;
        let moveForward = false;
        let moveBackward = false;
        let moveLeft = false;
        let moveRight = false;
        let moveUp = false;
        let moveDown = false;
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        
        // Информация о планетах
        const planetInfo = {
            sun: {
                name: "Солнце",
                description: "Звезда, вокруг которой обращаются все планеты системы. Состоит в основном из водорода и гелия.",
                diameter: "1 391 000 км",
                mass: "1.989 × 10^30 кг",
                wiki: "https://ru.wikipedia.org/wiki/Солнце",
                search: "Sun star"
            },
            mercury: {
                name: "Меркурий",
                description: "Ближайшая к Солнцу планета. Не имеет естественных спутников.",
                diameter: "4 879 км",
                mass: "3.301 × 10^23 кг",
                wiki: "https://ru.wikipedia.org/wiki/Меркурий",
                search: "Mercury planet"
            },
            venus: {
                name: "Венера",
                description: "Вторая планета от Солнца. Имеет плотную атмосферу из углекислого газа.",
                diameter: "12 104 км",
                mass: "4.867 × 10^24 кг",
                wiki: "https://ru.wikipedia.org/wiki/Венера",
                search: "Venus planet"
            },
            earth: {
                name: "Земля",
                description: "Третья планета от Солнца. Единственное известное тело во Вселенной, населённое живыми организмами.",
                diameter: "12 742 км",
                mass: "5.972 × 10^24 кг",
                wiki: "https://ru.wikipedia.org/wiki/Земля",
                search: "Earth planet"
            },
            mars: {
                name: "Марс",
                description: "Четвёртая планета от Солнца. Известен как 'Красная планета' из-за оксида железа на поверхности.",
                diameter: "6 779 км",
                mass: "6.417 × 10^23 кг",
                wiki: "https://ru.wikipedia.org/wiki/Марс",
                search: "Mars planet"
            },
            jupiter: {
                name: "Юпитер",
                description: "Крупнейшая планета Солнечной системы. Газовый гигант с заметным Большим красным пятном.",
                diameter: "139 820 км",
                mass: "1.898 × 10^27 кг",
                wiki: "https://ru.wikipedia.org/wiki/Юпитер",
                search: "Jupiter planet"
            },
            saturn: {
                name: "Сатурн",
                description: "Шестая планета от Солнца. Известна своими кольцами, состоящими из льда и камней.",
                diameter: "116 460 км",
                mass: "5.683 × 10^26 кг",
                wiki: "https://ru.wikipedia.org/wiki/Сатурн",
                search: "Saturn planet"
            },
            uranus: {
                name: "Уран",
                description: "Седьмая планета от Солнца. Имеет уникальное боковое вращение вокруг своей оси.",
                diameter: "50 724 км",
                mass: "8.681 × 10^25 кг",
                wiki: "https://ru.wikipedia.org/wiki/Уран",
                search: "Uranus planet"
            },
            neptune: {
                name: "Нептун",
                description: "Восьмая и самая дальняя планета Солнечной системы. Открыта благодаря математическим расчётам.",
                diameter: "49 244 км",
                mass: "1.024 × 10^26 кг",
                wiki: "https://ru.wikipedia.org/wiki/Нептун",
                search: "Neptune planet"
            },
            moon: {
                name: "Луна",
                description: "Естественный спутник Земли. Единственное астрономическое тело вне Земли, которое посетил человек.",
                diameter: "3 474 км",
                mass: "7.342 × 10^22 кг",
                wiki: "https://ru.wikipedia.org/wiki/Луна",
                search: "Moon"
            }
        };

        // Параметры планет (размер, расстояние от Солнца, скорость вращения, цвет)
        const planetParams = {
            sun: { radius: 5, distance: 0, rotationSpeed: 0.001, color: 0xffcc00 },
            mercury: { radius: 0.8, distance: 10, rotationSpeed: 0.004, color: 0xa9a9a9 },
            venus: { radius: 1.2, distance: 15, rotationSpeed: 0.002, color: 0xffb366 },
            earth: { radius: 1.3, distance: 20, rotationSpeed: 0.005, color: 0x3399ff },
            mars: { radius: 1.1, distance: 25, rotationSpeed: 0.004, color: 0xff6633 },
            jupiter: { radius: 2.8, distance: 35, rotationSpeed: 0.009, color: 0xffcc99 },
            saturn: { radius: 2.4, distance: 45, rotationSpeed: 0.008, color: 0xffdbac },
            uranus: { radius: 1.8, distance: 55, rotationSpeed: 0.007, color: 0x99ccff },
            neptune: { radius: 1.8, distance: 65, rotationSpeed: 0.006, color: 0x3366ff },
            moon: { radius: 0.4, distance: 2.5, rotationSpeed: 0.003, color: 0xdddddd }
        };

        // Инициализация сцены
        function init() {
            // Создание сцены
            scene = new THREE.Scene();
            
            // Создание камеры
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 50;
            
            // Создание рендерера
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('container').appendChild(renderer.domElement);
            
            // Добавление управления камерой
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 5;
            controls.maxDistance = 200;
            
            // Инициализация Raycaster для определения наведения на планеты
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Создание информационной карточки
            createInfoCard();
            
            // Создание звездного фона
            createStars();
            
            // Создание Солнца и планет
            createSun();
            createPlanets();
            createMoon();
            
            // Добавление освещения
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);
            
            const sunLight = new THREE.PointLight(0xffcc00, 1.5, 300);
            scene.add(sunLight);
            
            // Обработка изменений размера окна
            window.addEventListener('resize', onWindowResize);
            
            // Настройка элементов управления
            document.getElementById('rotation-speed').addEventListener('input', function(e) {
                rotationSpeed = parseFloat(e.target.value);
                document.getElementById('speed-value').textContent = rotationSpeed.toFixed(1) + 'x';
            });
            
            document.getElementById('planet-size').addEventListener('input', function(e) {
                planetSize = parseFloat(e.target.value);
                document.getElementById('size-value').textContent = planetSize.toFixed(1) + 'x';
                updatePlanetSizes();
            });
            
            // Обработка выбора планет
            document.querySelectorAll('.planet-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.planet-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFocus = this.getAttribute('data-planet');
                    focusOnPlanet(currentFocus);
                });
            });
            
            // Обработка движения мыши для показа информации
            document.addEventListener('mousemove', onMouseMove);
            
            // Обработка кликов для открытия модального окна
            document.addEventListener('click', onPlanetClick);
            
            // Обработка закрытия модального окна
            document.querySelector('.close-btn').addEventListener('click', closeModal);
            document.getElementById('search-btn').addEventListener('click', performSearch);
            
            // Обработка свободной камеры
            setupFreeCameraControls();
            
            // Скрыть загрузочный экран
            document.getElementById('loading').style.display = 'none';
            
            // Запуск анимации
            animate();
        }

        // Настройка управления свободной камерой
        function setupFreeCameraControls() {
            // Обработка нажатия колеса мыши
            renderer.domElement.addEventListener('mousedown', (e) => {
                if (e.button === 1) { // Колесо мыши
                    freeCamEnabled = true;
                    controls.enabled = false;
                    document.body.style.cursor = 'move';
                }
            });
            
            // Обработка отпускания колеса мыши
            renderer.domElement.addEventListener('mouseup', (e) => {
                if (e.button === 1) { // Колесо мыши
                    freeCamEnabled = false;
                    controls.enabled = true;
                    document.body.style.cursor = 'auto';
                }
            });
            
            // Обработка клавиш WASD для перемещения
            document.addEventListener('keydown', (e) => {
                if (!freeCamEnabled) return;
                
                switch(e.key.toLowerCase()) {
                    case 'w': moveForward = true; break;
                    case 's': moveBackward = true; break;
                    case 'a': moveLeft = true; break;
                    case 'd': moveRight = true; break;
                    case 'q': moveUp = true; break;
                    case 'e': moveDown = true; break;
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (!freeCamEnabled) return;
                
                switch(e.key.toLowerCase()) {
                    case 'w': moveForward = false; break;
                    case 's': moveBackward = false; break;
                    case 'a': moveLeft = false; break;
                    case 'd': moveRight = false; break;
                    case 'q': moveUp = false; break;
                    case 'e': moveDown = false; break;
                }
            });
            
            // Обработка движения мыши для свободной камеры
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!freeCamEnabled) return;
                
                const movementX = e.movementX || 0;
                const movementY = e.movementY || 0;
                
                camera.rotation.y -= movementX * 0.005;
                camera.rotation.x -= movementY * 0.005;
                
                // Ограничение вращения по X чтобы избежать переворота
                camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
            });
        }

        // Обновление свободной камеры
        function updateFreeCamera(delta) {
            velocity.x = velocity.y = velocity.z = 0;
            
            if (moveForward) velocity.z = -50.0 * delta;
            if (moveBackward) velocity.z = 50.0 * delta;
            if (moveLeft) velocity.x = -50.0 * delta;
            if (moveRight) velocity.x = 50.0 * delta;
            if (moveUp) velocity.y = 50.0 * delta;
            if (moveDown) velocity.y = -50.0 * delta;
            
            // Применяем направление камеры к движению
            direction.set(0, 0, 0);
            if (velocity.z !== 0) direction.z = velocity.z;
            if (velocity.x !== 0) direction.x = velocity.x;
            if (velocity.y !== 0) direction.y = velocity.y;
            
            direction.applyQuaternion(camera.quaternion);
            camera.position.add(direction);
        }

        // Создание информационной карточки
        function createInfoCard() {
            infoCard = document.createElement('div');
            infoCard.className = 'info-card';
            document.body.appendChild(infoCard);
        }

        // Создание звездного фона
        function createStars() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.2,
                sizeAttenuation: true
            });
            
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        // Создание Солнца с эффектом свечения
        function createSun() {
            const geometry = new THREE.SphereGeometry(planetParams.sun.radius, 64, 64);
            const material = new THREE.MeshBasicMaterial({ 
                color: planetParams.sun.color,
                emissive: 0xff9900,
                emissiveIntensity: 0.8
            });
            
            const sun = new THREE.Mesh(geometry, material);
            scene.add(sun);
            
            // Добавляем текстуру для Солнца
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load('https://space-assets-1.s3.us-east-2.amazonaws.com/sun.jpg', function(texture) {
                material.map = texture;
                material.needsUpdate = true;
            });
            
            // Добавляем свечение вокруг Солнца
            const glowGeometry = new THREE.SphereGeometry(planetParams.sun.radius * 1.2, 32, 32);
            const glowMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    glowColor: { value: new THREE.Color(0xff9900) },
                    viewVector: { value: camera.position }
                },
                vertexShader: `
                    uniform vec3 viewVector;
                    varying float intensity;
                    void main() {
                        vec3 vNormal = normalize(normalMatrix * normal);
                        vec3 vNormel = normalize(normalMatrix * viewVector);
                        intensity = pow(0.4 - dot(vNormal, vNormel), 2.0);
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform vec3 glowColor;
                    varying float intensity;
                    void main() {
                        vec3 glow = glowColor * intensity;
                        gl_FragColor = vec4(glow, 1.0);
                    }
                `,
                side: THREE.BackSide,
                blending: THREE.AdditiveBlending,
                transparent: true
            });
            
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            glow.scale.set(1.1, 1.1, 1.1);
            scene.add(glow);
            
            // Создаем подпись для Солнца
            createPlanetLabel('sun', sun);
            
            planets.sun = { 
                mesh: sun, 
                glow: glow, 
                rotationSpeed: planetParams.sun.rotationSpeed,
                baseRadius: planetParams.sun.radius
            };
        }

        // Создание подписи для планеты
        function createPlanetLabel(planetName, mesh) {
            const label = document.createElement('div');
            label.className = 'planet-label';
            label.textContent = planetInfo[planetName].name;
            label.id = `label-${planetName}`;
            document.body.appendChild(label);
            
            planetLabels[planetName] = {
                element: label,
                mesh: mesh
            };
        }

        // Создание планет с текстурами
        function createPlanets() {
            const textureLoader = new THREE.TextureLoader();
            
            // Создаем все планеты кроме Солнца
            for (const [name, params] of Object.entries(planetParams)) {
                if (name === 'sun' || name === 'moon') continue;
                
                const geometry = new THREE.SphereGeometry(params.radius, 64, 64);
                const material = new THREE.MeshPhongMaterial({ 
                    color: params.color,
                    specular: 0xffffff,
                    shininess: 30
                });
                
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.x = params.distance;
                
                // Загрузка текстур для планет
                const textureUrls = {
                    mercury: 'https://space-assets-1.s3.us-east-2.amazonaws.com/mercury.jpg',
                    venus: 'https://space-assets-1.s3.us-east-2.amazonaws.com/venus.jpg',
                    earth: 'https://space-assets-1.s3.us-east-2.amazonaws.com/earth.jpg',
                    mars: 'https://space-assets-1.s3.us-east-2.amazonaws.com/mars.jpg',
                    jupiter: 'https://space-assets-1.s3.us-east-2.amazonaws.com/jupiter.jpg',
                    saturn: 'https://space-assets-1.s3.us-east-2.amazonaws.com/saturn.jpg',
                    uranus: 'https://space-assets-1.s3.us-east-2.amazonaws.com/uranus.jpg',
                    neptune: 'https://space-assets-1.s3.us-east-2.amazonaws.com/neptune.jpg'
                };
                
                if (textureUrls[name]) {
                    textureLoader.load(textureUrls[name], function(texture) {
                        material.map = texture;
                        material.needsUpdate = true;
                    });
                }
                
                // Создание орбиты
                const orbitGeometry = new THREE.RingGeometry(params.distance - 0.1, params.distance + 0.1, 64);
                const orbitMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x4488ff, 
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.2
                });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.rotation.x = Math.PI / 2;
                scene.add(orbit);
                
                scene.add(mesh);
                
                // Добавляем кольца для Сатурна
                if (name === 'saturn') {
                    const ringGeometry = new THREE.RingGeometry(params.radius * 1.2, params.radius * 2, 32);
                    const ringMaterial = new THREE.MeshBasicMaterial({
                        color: 0xffdbac,
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.8
                    });
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring.rotation.x = Math.PI / 2;
                    mesh.add(ring);
                }
                
                // Создаем подпись для планеты
                createPlanetLabel(name, mesh);
                
                planets[name] = { 
                    mesh: mesh, 
                    angle: Math.random() * Math.PI * 2,
                    speed: params.rotationSpeed,
                    distance: params.distance,
                    baseRadius: params.radius
                };
            }
        }

        // Создание Луны
        function createMoon() {
            const params = planetParams.moon;
            const geometry = new THREE.SphereGeometry(params.radius, 32, 32);
            const material = new THREE.MeshPhongMaterial({ 
                color: params.color,
                specular: 0xffffff,
                shininess: 30
            });
            
            const mesh = new THREE.Mesh(geometry, material);
            
            // Загрузка текстуры для Луны
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load('https://space-assets-1.s3.us-east-2.amazonaws.com/moon.jpg', function(texture) {
                material.map = texture;
                material.needsUpdate = true;
            });
            
            // Луна будет вращаться вокруг Земли
            const earth = planets.earth.mesh;
            earth.add(mesh);
            mesh.position.x = params.distance;
            
            // Создаем подпись для Луны
            createPlanetLabel('moon', mesh);
            
            planets.moon = { 
                mesh: mesh, 
                angle: Math.random() * Math.PI * 2,
                speed: params.rotationSpeed,
                distance: params.distance,
                baseRadius: params.radius,
                parent: earth
            };
        }

        // Обновление размеров планет
        function updatePlanetSizes() {
            for (const [name, planet] of Object.entries(planets)) {
                if (name === 'sun') {
                    planet.mesh.scale.set(planetSize, planetSize, planetSize);
                    planet.glow.scale.set(planetSize, planetSize, planetSize);
                } else {
                    planet.mesh.scale.set(planetSize, planetSize, planetSize);
                }
            }
        }

        // Фокусировка на выбранной планете
        function focusOnPlanet(planetName) {
            const planet = planets[planetName];
            if (planet) {
                controls.target.copy(planet.mesh.position);
                
                if (planetName === 'sun') {
                    camera.position.set(0, 0, planet.baseRadius * 3 * planetSize);
                } else {
                    const distance = planet.baseRadius * 5 * planetSize;
                    camera.position.set(
                        planet.mesh.position.x + distance,
                        planet.mesh.position.y,
                        planet.mesh.position.z + distance
                    );
                }
            }
        }

        // Обработка движения мыши
        function onMouseMove(event) {
            // Обновляем позицию мыши
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Позиционируем информационную карточку рядом с курсором
            infoCard.style.left = (event.clientX + 15) + 'px';
            infoCard.style.top = (event.clientY + 15) + 'px';
            
            // Обновляем позиции подписей
            updateLabelPositions();
        }

        // Обработка клика по планете
        function onPlanetClick(event) {
            // Обновляем Raycaster с текущей позицией мыши и камерой
            raycaster.setFromCamera(mouse, camera);
            
            // Собираем все меши планет для проверки пересечения
            const planetMeshes = [];
            const planetMeshMap = new Map();
            
            for (const [name, planet] of Object.entries(planets)) {
                planetMeshes.push(planet.mesh);
                planetMeshMap.set(planet.mesh, name);
            }
            
            // Проверяем пересечения
            const intersects = raycaster.intersectObjects(planetMeshes);
            
            if (intersects.length > 0) {
                const planetMesh = intersects[0].object;
                const planetName = planetMeshMap.get(planetMesh);
                
                // Открываем модальное окно с Google поиском
                openGoogleModal(planetName);
            }
        }

        // Открытие модального окна с Google поиском
        function openGoogleModal(planetName) {
            const modal = document.getElementById('google-modal');
            const title = document.getElementById('modal-title');
            const searchInput = document.getElementById('planet-search');
            const iframe = document.getElementById('google-frame');
            
            const info = planetInfo[planetName];
            title.textContent = `Изображения: ${info.name}`;
            searchInput.value = info.search;
            searchInput.setAttribute('data-planet', planetName);
            
            // Формируем URL для поиска изображений в Google
            const searchQuery = encodeURIComponent(info.search);
            const searchUrl = `https://www.google.com/search?q=${searchQuery}&tbm=isch`;
            
            iframe.src = searchUrl;
            modal.style.display = 'block';
        }

        // Закрытие модального окна
        function closeModal() {
            const modal = document.getElementById('google-modal');
            modal.style.display = 'none';
            const iframe = document.getElementById('google-frame');
            iframe.src = 'about:blank';
        }

        // Выполнение поиска
        function performSearch() {
            const searchInput = document.getElementById('planet-search');
            const iframe = document.getElementById('google-frame');
            const planetName = searchInput.getAttribute('data-planet');
            const title = document.getElementById('modal-title');
            
            const searchQuery = encodeURIComponent(searchInput.value);
            const searchUrl = `https://www.google.com/search?q=${searchQuery}&tbm=isch`;
            
            iframe.src = searchUrl;
            
            if (planetName) {
                const info = planetInfo[planetName];
                title.textContent = `Изображения: ${searchInput.value}`;
            }
        }

        // Обновление позиций подписей планет
        function updateLabelPositions() {
            for (const [name, label] of Object.entries(planetLabels)) {
                const mesh = label.mesh;
                const vector = new THREE.Vector3();
                
                // Получаем позицию планеты в экранных координатах
                vector.setFromMatrixPosition(mesh.matrixWorld);
                vector.project(camera);
                
                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = -(vector.y * 0.5 - 0.5) * window.innerHeight;
                
                // Обновляем позицию подписи
                label.element.style.left = x + 'px';
                label.element.style.top = y + 'px';
            }
            
            // Проверяем, наведен ли курсор на какую-либо планету
            checkPlanetHover();
        }

        // Проверка наведения на планету
        function checkPlanetHover() {
            // Обновляем Raycaster с текущей позицией мыши и камерой
            raycaster.setFromCamera(mouse, camera);
            
            // Собираем все меши планет для проверки пересечения
            const planetMeshes = [];
            const planetMeshMap = new Map();
            
            for (const [name, planet] of Object.entries(planets)) {
                planetMeshes.push(planet.mesh);
                planetMeshMap.set(planet.mesh, name);
            }
            
            // Проверяем пересечения
            const intersects = raycaster.intersectObjects(planetMeshes);
            
            if (intersects.length > 0) {
                const planetMesh = intersects[0].object;
                const planetName = planetMeshMap.get(planetMesh);
                
                // Показываем информацию о планете
                showPlanetInfo(planetName);
            } else {
                // Скрываем информационную карточку
                hidePlanetInfo();
            }
        }

        // Показать информацию о планете
        function showPlanetInfo(planetName) {
            const info = planetInfo[planetName];
            infoCard.innerHTML = `
                <h3>${info.name}</h3>
                <p>${info.description}</p>
                <p><strong>Диаметр:</strong> ${info.diameter}</p>
                <p><strong>Масса:</strong> ${info.mass}</p>
                <a href="${info.wiki}" target="_blank">Узнать больше в Википедии</a>
            `;
            infoCard.style.opacity = '1';
            
            // Подсвечиваем подпись планеты
            const label = document.getElementById(`label-${planetName}`);
            if (label) {
                label.style.background = 'rgba(0, 50, 100, 0.9)';
                label.style.borderColor = 'rgba(100, 200, 255, 0.8)';
                label.style.boxShadow = '0 0 10px rgba(100, 200, 255, 0.5)';
            }
        }

        // Скрыть информацию о планете
        function hidePlanetInfo() {
            infoCard.style.opacity = '0';
            
            // Убираем подсветку со всех подписей
            document.querySelectorAll('.planet-label').forEach(label => {
                label.style.background = 'rgba(0, 0, 0, 0.7)';
                label.style.borderColor = 'rgba(100, 200, 255, 0.5)';
                label.style.boxShadow = 'none';
            });
        }

        // Анимация
        function animate() {
            requestAnimationFrame(animate);
            
            const delta = Math.min(0.05, clock.getDelta());
            
            // Обновляем свободную камеру если она активна
            if (freeCamEnabled) {
                updateFreeCamera(delta);
            }
            
            // Вращение Солнца
            planets.sun.mesh.rotation.y += planets.sun.rotationSpeed * rotationSpeed;
            planets.sun.glow.rotation.y += planets.sun.rotationSpeed * rotationSpeed * 0.5;
            
            // Вращение планет вокруг Солнца и вокруг своей оси
            for (const [name, planet] of Object.entries(planets)) {
                if (name !== 'sun' && name !== 'moon') {
                    // Вращение вокруг Солнца
                    planet.angle += planet.speed * rotationSpeed * 0.1;
                    planet.mesh.position.x = Math.cos(planet.angle) * planet.distance;
                    planet.mesh.position.z = Math.sin(planet.angle) * planet.distance;
                    
                    // Вращение вокруг своей оси
                    planet.mesh.rotation.y += planet.speed * rotationSpeed;
                }
            }
            
            // Вращение Луны вокруг Земли
            if (planets.moon) {
                planets.moon.angle += planets.moon.speed * rotationSpeed * 2;
                planets.moon.mesh.position.x = Math.cos(planets.moon.angle) * planets.moon.distance;
                planets.moon.mesh.position.z = Math.sin(planets.moon.angle) * planets.moon.distance;
                planets.moon.mesh.rotation.y += planets.moon.speed * rotationSpeed;
            }
            
            // Обновляем позиции подписей
            updateLabelPositions();
            
            if (!freeCamEnabled) {
                controls.update();
            }
            
            renderer.render(scene, camera);
        }

        // Обработка изменения размера окна
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // Обновляем позиции подписей при изменении размера окна
            updateLabelPositions();
        }

        // Инициализация часов для расчета delta time
        const clock = new THREE.Clock();
        
        // Запуск приложения после загрузки страницы
        window.addEventListener('load', init);
    </script>
</body>
</html>